<Project Sdk="Microsoft.NET.Sdk">

  <!-- Assembly attributes -->
  <PropertyGroup>
    <AssemblyTitle>System.Private.CoreLib</AssemblyTitle>
    <AssemblyName>System.Private.CoreLib</AssemblyName>
    <AssemblyVersion>4.0.0.0</AssemblyVersion>
    <MajorVersion>4</MajorVersion>
    <MinorVersion>6</MinorVersion>
    <ExcludeAssemblyInfoPartialFile>true</ExcludeAssemblyInfoPartialFile>
  </PropertyGroup>
  <!-- Compilation options -->
  <PropertyGroup>
    <TargetFramework>netstandard2.0</TargetFramework>
    <TargetFrameworkIdentifier>.NETStandard</TargetFrameworkIdentifier>
    <TargetFrameworkVersion>2.0</TargetFrameworkVersion>
    <IsCoreAssembly>true</IsCoreAssembly>
    <FeaturePortableTimer>true</FeaturePortableTimer>
    <!-- <ProjectGuid>{631BC4F3-E2D8-4319-814C-13904CAA17CE}</ProjectGuid> -->
    <OutputType>Library</OutputType>
    <LangVersion>8.0</LangVersion>
    <RootNamespace>System</RootNamespace>
    <ConfigurationOverrideFile />
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <WarningLevel>4</WarningLevel>
    <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
    <WarningsNotAsErrors>$(WarningsNotAsErrors);618</WarningsNotAsErrors>
    <NoWarn>649,3019,414,169,3015,591,1573,1591,0419</NoWarn>
    <!-- Disable nullability-related warnings -->
    <NoWarn>$(NoWarn),CS8609,CS8611,CS8631,CS8632</NoWarn>
    <GenerateTargetFrameworkAttribute>false</GenerateTargetFrameworkAttribute>
    <!-- <SignAssembly>true</SignAssembly>
    <DelaySign>true</DelaySign> -->
    <DefineConstants>$(DefineConstants);_USE_NLS_PLUS_TABLE;CODE_ANALYSIS_BASELINE;netcoreapp</DefineConstants>
    <SkipCommonResourcesIncludes>true</SkipCommonResourcesIncludes>
    <OutputPath>..\..\bin\</OutputPath>
    <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
  </PropertyGroup>
  <!-- Configuration specific properties -->
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <DebugSymbols>true</DebugSymbols>
    <Optimize Condition="'$(Optimize)' == ''">false</Optimize>
    <DebugType Condition="'$(DebugType)' == ''">full</DebugType>
    <DefineConstants>_LOGGING;DEBUG;TRACE;$(DefineConstants)</DefineConstants>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <DebugSymbols>true</DebugSymbols>
    <Optimize Condition="'$(Optimize)' == ''">true</Optimize>
    <DebugType Condition="'$(DebugType)' == ''">pdbOnly</DebugType>
    <DefineConstants>TRACE;$(DefineConstants)</DefineConstants>
    <WarningLevel>2</WarningLevel>
  </PropertyGroup>
  <!-- Make portable PDBs on Unix -->
  <PropertyGroup Condition="'$(OsEnvironment)' == 'Unix'">
    <DebugType>portable</DebugType>
  </PropertyGroup>

  <!-- Disable code paths that require project.assets.json files to be present or to be computed. -->
  <PropertyGroup>
    <GenerateDependencyFile>false</GenerateDependencyFile>
    <ComputeNETCoreBuildOutputFiles>false</ComputeNETCoreBuildOutputFiles>
    <GenerateRuntimeConfigurationFiles>false</GenerateRuntimeConfigurationFiles>
  </PropertyGroup>

  <!--Disable .NET Core SDK libs-->
  <PropertyGroup>
    <!-- This prevents the default MsBuild targets from referencing System.Core.dll -->
    <AddAdditionalExplicitAssemblyReferences>false</AddAdditionalExplicitAssemblyReferences>
    <!-- These prevent the default MsBuild targets from referencing System.dll and mscorlib.dll -->
    <ExcludeMscorlibFacade>true</ExcludeMscorlibFacade>
    <NoStdLib>true</NoStdLib>
    <NoCompilerStandardLib>true</NoCompilerStandardLib>
    <DisableImplicitFrameworkReferences>true</DisableImplicitFrameworkReferences>
    <DisableStandardFrameworkResolution>true</DisableStandardFrameworkResolution>
    <ImplicitlyExpandNETStandardFacades>false</ImplicitlyExpandNETStandardFacades>
    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
  </PropertyGroup>

  <ItemGroup>
    <!-- Mark netstandard as a framework assembly -->
    <AssemblyMetadata Include=".NETFrameworkAssembly">
      <Value></Value>
    </AssemblyMetadata>
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="runtime.linux-x64.Microsoft.NETCore.App" Version="3.0.0-preview4-27615-11" GeneratePathProperty="true" />
  </ItemGroup>

  <!--
    Helper Paths
  -->
  <!--<PropertyGroup>
    <CommonPath>$(MSBuildThisFileDirectory)Common</CommonPath>
    <BclSourcesRoot>$(MSBuildThisFileDirectory)</BclSourcesRoot>
    <MscorlibDir>$(MSBuildThisFileDirectory)</MscorlibDir>
    <NlpObjDir>$(BclSourcesRoot)\System\Globalization\Tables</NlpObjDir>
  </PropertyGroup>-->

  <Target Name="GenerateCompilerResponseFile" BeforeTargets="CoreCompile">
    <Message Text="Generating module name response file: $(IntermediateOutputPath)korlib.rsp" />
    <Message Text="VS Version: $(VisualStudioVersion); Tools Version: $(MSBuildToolsVersion)" />
    <WriteLinesToFile File="$(IntermediateOutputPath)korlib.rsp" Lines="/runtimemetadataversion:v4.0.30319" Overwrite="true" />
    <ItemGroup>
      <Clean Include="$(IntermediateOutputPath)korlib.rsp" />
    </ItemGroup>
    <PropertyGroup>
      <CompilerResponseFile>$(IntermediateOutputPath)korlib.rsp</CompilerResponseFile>
    </PropertyGroup>
  </Target>

  <Target Name="CopyRuntimeLibs" AfterTargets="Build">
    <ItemGroup>
      <PackageReferenceFiles
        Include="$(Pkgruntime_linux-x64_Microsoft_NETCore_App)\runtimes\linux-x64\lib\netcoreapp3.0\*" />
    </ItemGroup>
    <Copy SourceFiles="@(PackageReferenceFiles)" DestinationFolder="$(OutDir)" />
  </Target>
</Project>
